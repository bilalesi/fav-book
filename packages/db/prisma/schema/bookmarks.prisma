enum Platform {
    TWITTER
    LINKEDIN
    GENERIC_URL
}

enum MediaType {
    IMAGE
    VIDEO
    LINK
}

enum ProcessingStatus {
    PENDING
    PROCESSING
    COMPLETED
    FAILED
    PARTIAL_SUCCESS
}

enum DownloadStatus {
    PENDING
    DOWNLOADING
    COMPLETED
    FAILED
}

model BookmarkPost {
    id               String   @id @default(cuid())
    userId           String
    platform         Platform
    postId           String
    postUrl          String
    content          String   @db.Text
    authorName       String
    authorUsername   String
    authorProfileUrl String
    savedAt          DateTime @default(now())
    createdAt        DateTime
    viewCount        Int      @default(0)
    metadata         Json?

    user            User                     @relation(fields: [userId], references: [id], onDelete: Cascade)
    media           Media[]
    collections     BookmarkPostCollection[]
    categories      BookmarkPostCategory[]
    enrichment      BookmarkEnrichment?
    downloadedMedia DownloadedMedia[]

    @@unique([userId, platform, postId])
    @@index([userId, savedAt])
    @@index([platform])
    @@index([authorUsername])
    @@index([createdAt])
    @@map("bookmark_post")
}

model BookmarkEnrichment {
    id               String           @id @default(cuid())
    bookmarkPostId   String           @unique
    summary          String?          @db.Text
    keywords         Json?
    tags             Json?
    processingStatus ProcessingStatus @default(PENDING)
    workflowId       String?
    errorMessage     String?          @db.Text
    enrichedAt       DateTime?
    createdAt        DateTime         @default(now())
    updatedAt        DateTime         @updatedAt

    bookmarkPost BookmarkPost @relation(fields: [bookmarkPostId], references: [id], onDelete: Cascade)

    @@index([processingStatus])
    @@index([enrichedAt])
    @@map("bookmark_enrichment")
}

model Media {
    id             String    @id @default(cuid())
    bookmarkPostId String
    type           MediaType
    url            String
    thumbnailUrl   String?
    metadata       Json?

    bookmarkPost BookmarkPost @relation(fields: [bookmarkPostId], references: [id], onDelete: Cascade)

    @@index([bookmarkPostId])
    @@map("media")
}

model DownloadedMedia {
    id             String         @id @default(cuid())
    bookmarkPostId String
    type           MediaType
    originalUrl    String
    storagePath    String
    storageUrl     String?
    fileSize       BigInt
    duration       Int?
    quality        String?
    format         String?
    width          Int?
    height         Int?
    downloadStatus DownloadStatus @default(PENDING)
    errorMessage   String?        @db.Text
    downloadedAt   DateTime?
    createdAt      DateTime       @default(now())
    metadata       Json?

    bookmarkPost BookmarkPost @relation(fields: [bookmarkPostId], references: [id], onDelete: Cascade)

    @@index([bookmarkPostId])
    @@index([downloadStatus])
    @@map("downloaded_media")
}

model Collection {
    id          String   @id @default(cuid())
    userId      String
    name        String
    description String?  @db.Text
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt

    user      User                     @relation(fields: [userId], references: [id], onDelete: Cascade)
    bookmarks BookmarkPostCollection[]

    @@index([userId])
    @@map("collection")
}

model Category {
    id        String   @id @default(cuid())
    name      String
    userId    String?
    isSystem  Boolean  @default(false)
    createdAt DateTime @default(now())

    user      User?                  @relation(fields: [userId], references: [id], onDelete: Cascade)
    bookmarks BookmarkPostCategory[]

    @@unique([name, userId])
    @@index([userId])
    @@map("category")
}

model BookmarkPostCollection {
    bookmarkPostId String
    collectionId   String
    addedAt        DateTime @default(now())

    bookmarkPost BookmarkPost @relation(fields: [bookmarkPostId], references: [id], onDelete: Cascade)
    collection   Collection   @relation(fields: [collectionId], references: [id], onDelete: Cascade)

    @@id([bookmarkPostId, collectionId])
    @@map("bookmark_post_collection")
}

model BookmarkPostCategory {
    bookmarkPostId String
    categoryId     String
    assignedAt     DateTime @default(now())

    bookmarkPost BookmarkPost @relation(fields: [bookmarkPostId], references: [id], onDelete: Cascade)
    category     Category     @relation(fields: [categoryId], references: [id], onDelete: Cascade)

    @@id([bookmarkPostId, categoryId])
    @@map("bookmark_post_category")
}
